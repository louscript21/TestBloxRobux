<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blox Robux</title>
    <link rel="stylesheet" href="adminpanel.css">
    <link rel="icon" href="../img/favicon.ico" type="image/x-icon">
</head>
<body>

    <!-- ===== RIDEAU CHARGEMENT ===== -->
    <div id="transition" class="fade-transition active">
        <img src="../img/Robux.png" id="image" alt="Logo Blox Robux" />
        <div class="text" id="text-chargement">Chargement...</div>
    </div>

    <!-- ===== HEADER ===== -->
    <header>
        <a href="../index.html"><img src="../img/logo.png" alt="Logo De Blox Robux"></a>
        <div class="text">BloxRobux</div>
        <ul>
            <li><a id="btn-connexion" href="../Page de profil/Profil.html">Retour</a></li>
            <li>
                <a id="lien-profil" href="../Page de profil/Profil.html" style="display:flex; align-items:center; gap:10px;">
                    <span>Aucun compte</span>
                    <img id="avatar-roblox" src="../img/default-avatar.png" style="width:40px; height:40px; border-radius:50%;">
                </a>
            </li>
        </ul>
    </header>

    <!-- ===== CONTENU ===== -->
    <main>

        <!-- ===== LISTE UTILISATEURS ===== -->
        <section class="card">
            <h2>Liste des Utilisateurs</h2>

            <div class="search-bar">
                <input type="text" id="search" placeholder="Rechercher un utilisateur...">
                <select id="NBU">
                    <option value="5">Nombre d'utilisateurs :</option>
                    <option value="10">Par 10</option>
                    <option value="30">Par 30</option>
                    <option value="50">Par 50</option>
                    <option value="none">Tous</option>
                </select>
            </div>

            <table class="table">
                <thead>
                    <tr>
                        <th>Nom d'utilisateur</th>
                        <th>Solde</th>
                        <th>R√¥le</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="list">
                    <tr>
                        <td colspan="4">Chargement des utilisateurs...</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- ===== PROMOCODES ===== -->
        <section class="card">
            <h2>Promocodes</h2>
            <button class="btn create-promo">Cr√©er un promocode</button>
            <table class="table">
                <thead>
                    <tr>
                        <th>Nom</th>
                        <th>Robux</th>
                        <th>Utilisations restantes</th>
                        <th>Expiration</th>
                        <th>Statut</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>START50</td>
                        <td>50</td>
                        <td>12</td>
                        <td>25/02/2025</td>
                        <td><span class="status active">Actif</span></td>
                    </tr>
                    <tr>
                        <td>WIN200</td>
                        <td>200</td>
                        <td>0</td>
                        <td>01/12/2024</td>
                        <td><span class="status inactive">Inactif</span></td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- ===== MULTIPLICATEUR ===== -->
        <section class="card">
            <h2>Multiplicateur des Gains</h2>
            <div class="multiplier-box">
                <p>Multiplication actuelle : <span class="current-multiplier">x1.20</span></p>
                <input type="number" placeholder="Nouveau pourcentage (ex: 50 pour x1.50)">
                <button class="btn apply">Appliquer</button>
            </div>
        </section>

        <!-- ===== PLUIE ===== -->
        <section class="card">
            <h2>Cr√©er une Pluie de Robux</h2>
            <div class="rain-form">
                <input type="number" placeholder="Montant total de Robux">
                <input type="number" placeholder="Dur√©e en secondes">
                <button class="btn create-rain">Lancer la pluie</button>
            </div>
        </section>

    </main>

    <!-- ===== FIREBASE ===== -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
const db = window.db;
if (!db) {
  console.error("Firebase Database non initialis√©e !");
} else {
document.addEventListener("DOMContentLoaded", () => {
    const list = document.getElementById("list");
    const searchInput = document.getElementById("search");
    const nbuInput = document.getElementById("NBU");
    let allUsers = [];

    // üîé Fonction pour afficher en appliquant search + limite NBU
    function renderUsers() {
        const search = searchInput.value.toLowerCase();
        const limit = nbuInput.value === "none" ? allUsers.length : Number(nbuInput.value) || allUsers.length;
        list.innerHTML = "";
        let count = 0;
        for (const user of allUsers) {
            if (!user.username.toLowerCase().includes(search)) continue;
            if (count >= limit) break;
            count++;
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${user.username}</td>
                <td>${user.balance || 0} R$</td>
                <td>${user.role || "Utilisateur"}</td>
                <td class="actions">
                    <button class="btn profil">Profil</button>
                    <button class="btn credit">Cr√©diter</button>
                    <button class="btn ban">Bannir</button>
                    <button class="btn promote">Promouvoir</button>
                </td>
            `;
            list.appendChild(tr);
        }
    }

    searchInput.addEventListener("input", renderUsers);
    if (nbuInput) nbuInput.addEventListener("input", renderUsers); 

    // üîê Connexion admin et lecture DB
    auth.signInWithEmailAndPassword("louxi@bloxrobux.local", "Eeufl21%")
        .then(() => {
            console.log("Connect√© en admin ‚úÖ");
            return db.ref("users").get(); // <-- bien cha√Æn√©
        })
        .then(snapshot => {
            if (!snapshot.exists()) {
                list.innerHTML = "<tr><td colspan='4'>Aucun utilisateur trouv√©.</td></tr>";
                return;
            }
            const users = snapshot.val();
            allUsers = Object.keys(users).map(uid => ({
                username: users[uid].username,
                balance: users[uid].balance || 0,
                role: users[uid].role || "Utilisateur"
            }));
            renderUsers();
        })
        .catch(err => {
            console.error("Erreur connexion ou DB :", err);
            list.innerHTML = "<tr><td colspan='4'>Erreur lors du chargement des utilisateurs.</td></tr>";
        });
});
}
</script>
<script src="../Data.js" defer></script>
<script src="../Server.js" defer></script>
<script src="../Animation.js" defer></script>
</body>
</html>

