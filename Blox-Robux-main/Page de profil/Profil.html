<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blox Robux</title>
    <link rel="stylesheet" href="Profil.css">
    <link rel="icon" href="../img/favicon.ico" type="image/x-icon">
</head>

<body>
    <header>
        <a href="../index.html"><img src="../img/logo.png" alt="Logo De Blox Robux"></a>
        <div class="text">BloxRobux</div>
        <ul>
            <li>
                <a id="btn-connexion" href="../index.html">Retour</a>
            </li>
            <li>
            <a id="lien-profil" href="Profil.html" style="display:flex; align-items:center; gap:10px;">
                <span>Aucun compte</span>
                <img id="avatar-roblox" src="../img/default-avatar.png" style="width:40px; height:40px; border-radius:50%;">
            </a>
        </li>
        </ul>
    </header>

    <div class="welcome">
        <div class="pr√©sentation" id="acceuil">
            <div id="transition" class="fade-transition active">
                <img src="../img/Robux.png" id="image" alt="Logo Blox Robux" />
                <div class="text" id="text-chargement">Chargement...</div>
            </div>
        </div>
    </div>

    <!-- ---------- PROFIL ---------- -->
    <main>

        <!-- SECTION 1 : MODIFIER PROFIL -->
        <section class="card">
            <h2>üë§ Informations du profil</h2>

            <div class="form-group">
                <label>Pseudo Roblox</label>
                <input type="text" id="username" placeholder="Votre pseudo Roblox">
            </div>

            <div class="form-group">
                <label>Nouveau mot de passe</label>
                <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>

            <div class="form-group">
                <label>Email (optionnel)</label>
                <input type="email" id="email" placeholder="exemple@mail.com">
            </div>

            <button id="saveProfile">Enregistrer les informations</button>

            <p id="profileMessage" class="msg"></p>
        </section>

        <!-- SECTION 2 : PROMOCODE -->
        <section class="card">
            <h2>üéÅ Entrer un promocode</h2>

            <div class="form-group">
                <label>Code</label>
                <input type="text" id="promoInput" placeholder="Entrez votre code">
            </div>

            <button id="applyPromo">Valider le code</button>

            <p id="promoMessage" class="msg"></p>
        </section>

        <!-- SECTION 3 : ADMIN -->
        <section class="card">
            <h2>üîê Acc√®s au panel admin</h2>

            <div class="form-group" id="form-group">
                <label>Code Administrateur</label>
                <input type="password" id="adminCode" placeholder="Mot de passe admin">
            </div>

            <button id="adminEnter">Se connecter</button>
            <p id="adminMessage" class="msg"></p>
        </section>

    </main>

    <!-- ---------- SCRIPTS ---------- -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="../Data.js" defer></script>
    <script src="../Server.js" defer></script>
    <script src="../Animation.js" defer></script>

<script defer>
    document.addEventListener("DOMContentLoaded", () => {
        const db = window.db;
        if (!db) return console.error("Firebase Database non initialis√©e !");
        const STORAGE_KEY = "bloxrobux_balance";
        const balanceEl = document.getElementById("balance");

        function loadBalance() {
            const data = JSON.parse(localStorage.getItem(STORAGE_KEY)) || { balance: 0 };
            balanceEl.textContent = data.balance.toFixed(2).replace('.', ',') + " R$";
        }

        /* ----- BOUTON PROFIL ----- */
        document.getElementById("saveProfile").addEventListener("click", () => {
            const msg = document.getElementById("profileMessage");
            msg.textContent = "‚úîÔ∏è Profil mis √† jour.";
            msg.style.color = "#00ff6a";
            setTimeout(() => msg.textContent = "", 3000);
        });

        /* ----- PROMOCODE ----- */
        document.getElementById("applyPromo").addEventListener("click", () => {
            const code = document.getElementById("promoInput").value.trim().toLowerCase();
            const promos = { "welcome100": 100, "bonus50": 50, "mega500": 500 };

            const msg = document.getElementById("promoMessage");

            if (promos[code]) {
                let data = JSON.parse(localStorage.getItem(STORAGE_KEY)) || { balance: 0 };
                data.balance += promos[code];
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                msg.style.color = "#00ff6a";
                msg.textContent = `‚úîÔ∏è +${promos[code]} R$ ajout√© !`;
            } else {
                msg.style.color = "#ff5555";
                msg.textContent = "‚ùå Code invalide.";
            }

            setTimeout(() => msg.textContent = "", 3000);
        });

        /* ----- ADMIN ----- */
        document.getElementById("adminEnter").addEventListener("click", () => {
            const codeInput = document.getElementById("adminCode").value;
            const msg = document.getElementById("adminMessage");
            db.ref("admin/code").once("value").then(snapshot => {
                const correctCode = snapshot.val();

                if (codeInput === correctCode) {
                    msg.style.color = "#00ff6a";
                    msg.textContent = "‚úÖ Code correct.";
                    setTimeout(() => {
                        window.location.href = "../admin/adminpanel.html";
                    }, 1000);
                } else {
                    msg.style.color = "#ff5555";
                    msg.textContent = "‚ùå Code invalide.";
                }
                });
            });
        })
    </script>
</body>
</html>
